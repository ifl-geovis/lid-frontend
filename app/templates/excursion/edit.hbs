{{!-- placeholder  --}}
<div class="flex-20">
  {{#site-navigation showRegionListAction="regionList"}}
  {{/site-navigation}}
</div>

{{!-- Excursion edit --}}
<div class="flex-60">

    {{#paper-card class="meta-editor" as |card|}}
      {{#card.title as |title|}}
        {{#title.text as |text|}}
          {{#text.subhead}}{{model.id}}{{/text.subhead}}   
          {{#text.headline}}Metadaten{{/text.headline}} 
        {{/title.text}}
      {{/card.title}}

      {{#card.content}}
        
        {{!-- Titel --}}
        <div layout="" layout-sm="column">
    		  {{paper-input flex=100 label="Titel" value=model.title onChange=(action (mut model.title))}}    		  
    	  </div>

        {{!-- AutorIn --}}
        <div layout="" layout-sm="column">
          {{paper-input flex=40 label="AutorIn" value=model.autor onChange=(action (mut model.autor))}}
        </div>

        {{!-- Kurzbeschreibung --}}
        <div layout="" layout-sm="column">
          {{paper-input textarea=true block=true passThru=(hash rows=4) flex=100 label="Kurzbeschreibung" value=model.description onChange=(action (mut model.description))}}
        </div>

        {{!-- Literaturangaben --}}
        <div layout="" layout-sm="column">
          {{paper-input textarea=true block=true passThru=(hash rows=4) flex=100 label="Literaturangaben" value=model.literaturangaben onChange=(action (mut model.literaturangaben))}}
        </div>

        {{!-- Bildnachweise --}}
        <div layout="" layout-sm="column">
          {{paper-input textarea=true block=true flex=100 label="Bildnachweise" value=model.bildnachweise onChange=(action (mut model.bildnachweise))}}
        </div>

        {{!-- VG Wort Code --}}
        <div layout="" layout-sm="column">
          {{paper-input flex=70 label="VG Wort Code" value=model.vgWortCode onChange=(action (mut model.vgWortCode))}}
        </div>

        {{!-- Exkursionstypen --}}
        <div layout="" layout-sm="column">
          {{paper-input flex=70 label="Exkursionstypen" value=model.exkursionstypen onChange=(action (mut model.exkursionstypen))}}
        </div>


      {{!-- Fremdexkursionen/Actionbound ausschließen ! --}}
      {{#unless (or model.fremdexkursion model.actionbound) }}

        {{!-- Exkursionsroute --}}
      <div id="dialog-container">

        <h3 class="md-headline">Die Exkursionroute</h3>

        {{!-- Centroid, Zoomstufe, Exkursionsstationen --}}
        <div layout="" layout-sm="column">

          {{paper-input flex=25 label="Kartenmittelpunkt Lat." value=model.centroidLat onChange=(action (mut model.centroidLat))}}
          {{paper-input flex=25 label="Kartenmittelpunkt Lon." value=model.centroidLon onChange=(action (mut model.centroidLon))}}
          {{paper-input flex=25 label="Zoomstufe der Karte" value=model.zoomstufe type=number min=1 max=18 required=true onChange=(action (mut model.zoomstufe))}}
          {{paper-input flex=25 label="Exkursionsstationen" value=model.exkursionsstationen type=number min=1 required=true onChange=(action (mut model.exkursionsstationen))}}

        </div>

        {{!-- Kartenausschnitt, Exkursionsstationen --}}
        <div layout="" layout-sm="column">
          <p class="flex" onClick={{action "addExcursionStation"}}>Station hinzufügen</p>
          <p class="flex" onClick={{action "removeExcursionStation"}}>Letzte Station entfernen</p>
          <p class="flex" onClick={{action "setMapExtent"}}>Kartenausschnitt festlegen</p>

          {{!-- Set map extent --}}
          {{#if setMapExtentDialog}}
            {{#paper-dialog fullscreen=true onClose=(action "closeSetMapExtentDialog" "cancel") parent="#dialog-container" clickOutsideToClose=true}}

              {{#paper-toolbar}}
                <div class="md-toolbar-tools">
                  <h2>Kartenausschnitt festlegen</h2>
                  <span class="flex"></span>
                  {{#paper-button iconButton=true onClick=(action "closeSetMapExtentDialog" "cancel")}}{{paper-icon icon="close"}}{{/paper-button}}
                </div>
              {{/paper-toolbar}}

              {{#paper-dialog-content}}
              <div class="map-dialog">
                  {{#leaflet-map  class="map-dialog-container" scrollWheelZoom=false lat=model.centroidLat lng=model.centroidLon zoom=model.zoomstufe onZoomend=(action "queryMapExtent") onDragend=(action "queryMapExtent")}}
                  {{tile-layer url="https://api.tiles.mapbox.com/v4/ifl.lplpe32l/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiaWZsIiwiYSI6IksxanctMkUifQ.sAHrtehStvROYTeXS20NRg"}}

                  {{/leaflet-map}}
              </div>
              {{/paper-dialog-content}}

              {{#paper-dialog-actions class="layout-row"}}
                <span class="flex"></span>
                {{#paper-button primary=true onClick=(action "closeSetMapExtentDialog" "cancel")}}Abbrechen{{/paper-button}}
                {{#paper-button primary=true onClick=(action "saveMapExtent")}}Kartenausschnitt speichern{{/paper-button}}
              {{/paper-dialog-actions}}

            {{/paper-dialog}}
          {{/if}}

        </div>

        {{!-- Karte mit Exkursionsstationen --}}
        <div layout="" layout-sm="column">
          {{#leaflet-map scrollWheelZoom=false lat=model.centroidLat lng=model.centroidLon zoom=model.zoomstufe}}
              {{tile-layer url="https://api.tiles.mapbox.com/v4/ifl.lplpe32l/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiaWZsIiwiYSI6IksxanctMkUifQ.sAHrtehStvROYTeXS20NRg"}}

              {{#each model.exkursion as |excursion index|}}
                  {{#marker-layer draggable=true lat=excursion.lat lng=excursion.lon onDragend=(action "updateLocation" excursion index)}}
                    {{#tooltip-layer direction='top'}}
                      Station {{excursion.nr}}
                      <br>
                      {{excursion.lat}}, {{excursion.lon}}
                    {{/tooltip-layer}}
                  {{/marker-layer}}
              {{/each}}

          {{/leaflet-map}}
        </div>

      </div>
      {{/unless}}

      {{/card.content}}
    {{/paper-card}}

    {{#content-editor model=model excursion=true}}
    {{/content-editor}}

</div>

{{#editor-dock model=model updateExcursion=true deleteExcursion=true deleteExcursionAction="openDeleteDialog" updateExcursionAction="updateExcursion"}}
{{/editor-dock}}

{{#if updateDialog}}
  {{#update-dialog message="Die Änderung wurde gespeichert."}}
  {{/update-dialog}}
{{/if}}

{{#if deleteDialog}}
  {{#delete-excursion-dialog message="Die Exkursion wird gelöscht." closeDeleteDialogAction="closeDeleteDialog" deleteExcursionConfirmedAction="deleteExcursion"}}
  {{/delete-excursion-dialog}}
{{/if}}